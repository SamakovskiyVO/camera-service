4.1.6 Инженерная реализация и интеграция модуля обработки данных с видеокамер
Для обеспечения возможности промышленной эксплуатации модуля обработки данных с видеокамер были выполнены специальные инженерные работы, направленные на эффективную интеграцию разработанного микросервиса в общую архитектуру Блока Обнаружения Препятствий (БОП) беспилотного электропоезда ЭС2Г. В рамках этих работ были решены задачи по стандартизации выходных интерфейсов модуля, контейнеризации и развертыванию, обеспечению отказоустойчивости, масштабируемости и мониторинга состояния модуля в реальном времени.
4.1.6.1 Стандартизованные выходные интерфейсы модуля
Модуль обработки видеокадров формирует выходные данные в виде стандартизированных сообщений формата ZCM (Zero Communication Middleware). Использование единого формата для сообщений обеспечивает надежность и низкую задержку передачи данных (менее 1 мс), а также упрощает интеграцию с другими компонентами системы.
На выходе модуля формируются сообщения следующей структуры:
struct ZcmFrameQuality {
    int64_t timestamp;         // Временная метка кадра (Unix timestamp)
    int32_t frame_id;          // Уникальный идентификатор кадра
    float quality_probs[7];    // Вероятности принадлежности кадра к классам дефектов
    bool alert_flag;           // Флаг наличия дефекта (true при наличии дефекта)
    string dominant_defect;    // Тип наиболее вероятного дефекта
}

Поле quality_probs представляет собой массив вероятностей классификации кадра, что позволяет последующим компонентам системы гибко использовать эту информацию для принятия решений о критичности текущей ситуации.
Сообщения публикуются микросервисом в специально выделенный ZCM-канал:
ipc://FRAME_QUALITY_RESULT — для отправки итоговых результатов классификации и выявленных дефектов.
Кроме этого, предусмотрен специальный канал для диагностических и технических сообщений:
ipc://CAMERA_DIAGNOSTIC_INFO — сюда микросервис периодически отправляет информацию о текущем техническом состоянии (загрузка GPU, CPU, latency, время инференса и др.).


4.1.6.2 Контейнеризация модуля
Для упрощения процесса развертывания и обеспечения высокой отказоустойчивости микросервис обработки данных с видеокамер реализован в виде отдельного Docker-контейнера. Использование Docker-контейнеризации позволяет достичь следующих преимуществ:
Унификация среды исполнения — обеспечивает стабильную работу микросервиса независимо от особенностей аппаратного окружения вычислительного модуля БОП.
Быстрое и удобное масштабирование — возможность оперативного развертывания дополнительных экземпляров микросервиса при необходимости обработки большего количества потоков данных или изменения условий эксплуатации.
Изоляция и отказоустойчивость — минимизация риска выхода из строя всей системы из-за сбоев отдельного компонента.
Контейнер собирается на основе образа операционной системы Debian 11 с установленными необходимыми библиотеками для работы нейросетевой модели (PyTorch с CUDA-ускорением, ZCM-библиотека и другие системные зависимости).
Docker-контейнер развёртывается на вычислительных модулях платформы БОП посредством стандартного CI/CD-процесса, интегрированного с системой управления версиями и обновлениями ПО проекта (GitLab CI). Это позволяет минимизировать время простоя системы при обновлениях и обеспечить автоматическое тестирование новых версий.
4.1.6.3 Интеграция в архитектуру системы БОП
Модуль обработки данных с видеокамер является неотъемлемой частью вычислительной платформы БОП, состоящей из нескольких вычислительных устройств, в частности NVIDIA Jetson AGX Xavier и GPU NVIDIA RTX для обработки нейросетевых моделей. Интеграция микросервиса осуществляется в несколько последовательных шагов:
Подключение к шине данных ZCM
 Микросервис автоматически подключается к выделенным каналам ZCM и начинает обработку входящих данных. Адреса каналов и параметры подключения прописаны в конфигурационном файле YAML, передаваемом при запуске контейнера.
Взаимодействие с другими микросервисами системы
 На уровне взаимодействия микросервис активно коммуницирует с:
Микросервисом агрегации и оповещения оператора (передача итоговых классификаций кадров).
Системой мониторинга и диагностики (передача данных о состоянии, производительности и статистике работы).
Синхронизация времени и обеспечение корректности временных меток
 Время всех вычислительных устройств платформы БОП синхронизируется через протокол NTP, что обеспечивает точность временных меток с точностью до миллисекунд, необходимую для корректной работы алгоритмов агрегации и принятия решений.
